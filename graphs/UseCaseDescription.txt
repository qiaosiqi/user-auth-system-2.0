用例1: 用户登录
用例名称: 用户登录

参与者: 超级管理员、普通用户（主要参与者）

前置条件: 用户必须拥有有效的系统账号（即存在于用户表中，且状态为非禁用）。

主事件流:

系统在用户访问时显示登录界面。

用户输入用户名（或用户ID）和密码。

用户点击“登录”按钮。

系统接收登录凭证。

系统根据用户名查询用户表，验证用户是否存在且状态为“激活”。

系统使用加密算法验证密码是否匹配。

验证通过后，系统根据用户ID，通过用户-角色关联表查询该用户所拥有的所有角色。

系统根据角色ID，通过角色-权限关联表聚合该用户拥有的所有菜单权限标识符和操作权限标识符。

系统将用户基本信息（用户ID、姓名）和权限集合加载到当前会话中。

系统记录登录成功日志。

系统跳转至主页面或用户上次访问的页面。

用例结束。

辅事件流:

5a. 用户不存在或状态为“禁用”：

系统显示提示信息：“用户名或密码错误”。

返回至主事件流第1步。

6a. 密码不匹配：

系统显示提示信息：“用户名或密码错误”。

返回至主事件流第1步。

6b. 用户连续登录失败次数超过阈值：

系统将用户状态更新为“锁定”。

系统显示提示信息：“账户因多次尝试失败已被锁定，请联系管理员”。

用例结束。

后置条件: 用户成功通过身份认证，其身份信息和权限集合已加载到会话中，可以访问系统其他功能。

用例2: 用户管理
用例名称: 用户管理

参与者: 超级管理员（主要参与者）

前置条件: 超级管理员已成功登录系统。

主事件流:

超级管理员从主菜单导航至“用户管理”界面。

系统显示用户列表，列表数据来自用户表，并可关联显示用户所属部门等信息。

超级管理员可以：

新增: 点击“新增”按钮，填写用户基本信息（用户名、密码、姓名、邮箱、所属部门等），系统校验用户名唯一性后，将记录插入用户表。

修改: 选择一条用户记录，点击“修改”，更新除用户名外的信息，系统将更新用户表。

删除: 选择一条或多条记录，点击“删除”，系统执行逻辑删除（更新用户表中的状态标志为“已删除”）。

查询/过滤: 输入条件（如用户名、部门），系统动态查询用户表并刷新列表。

系统同步记录关键操作（如新增、删除）日志。

用例结束。

辅事件流:

3a. 新增用户时用户名重复：

系统提示“用户名已存在，请更换”。

返回至主事件流第3步的新增表单状态。

后置条件: 用户表被正确增、删、改、查，系统日志记录了管理员的操作。

用例3: 角色管理
用例名称: 角色管理

参与者: 超级管理员（主要参与者）

前置条件: 超级管理员已成功登录系统。

主事件流:

超级管理员从主菜单导航至“角色管理”界面。

系统显示角色列表，列表数据来自角色表。

超级管理员可以：

新增: 点击“新增”，输入角色名称、角色代码（唯一）、描述，系统校验角色代码唯一性后，将记录插入角色表。

修改: 选择一条角色记录，点击“修改”，可修改描述等信息（角色代码通常不可变）。

删除: 选择一条角色记录，点击“删除”。系统首先检查角色-用户关联表，确认无用户拥有此角色后，从角色表中逻辑删除该角色。

查询: 根据角色名称等条件过滤角色列表。

系统同步记录操作日志。

用例结束。

辅事件流:

3a. 删除角色时，发现存在关联用户：

系统提示“该角色下仍有用户，无法删除。请先解除所有用户与该角色的关联”。

用例结束。

后置条件: 角色表被正确增、删、改、查。

用例4: 控制菜单全局可见性
用例名称: 控制菜单全局可见性

参与者: 超级管理员（主要参与者）

前置条件: 超级管理员已成功登录系统。

主事件流:

超级管理员从主菜单导航至“菜单管理”或类似界面。

系统以树形结构展示所有功能菜单，数据来自菜单表（包含is_global_visible等控制字段）。

超级管理员点击某个子菜单节点旁的开关或复选框，以改变其“全局可见性”状态。

系统立即向后台发送请求，更新菜单表中该菜单记录的is_global_visible字段。

系统反馈操作结果（如“更新成功”）。

用例结束。

辅事件流:

4a. 网络异常导致更新失败：

系统提示“更新失败，请重试”。

菜单项的显示状态恢复为操作前的原状。

用例结束。

后置条件: 菜单表中指定菜单的全局可见性状态被更新。此更改将影响所有用户后续“查询菜单树”的结果。

用例5: 为角色分配权限
用例名称: 为角色分配权限

参与者: 超级管理员（主要参与者）

前置条件: 超级管理员已成功登录系统，且系统中已存在角色和定义好的菜单、操作权限点。

主事件流:

超级管理员在“角色管理”界面，选择一个目标角色。

点击“分配权限”按钮。

系统加载权限分配界面，通常是一个树形控件。树的第一级是菜单节点，叶子节点是菜单下的具体操作（如“新增”、“删除”），这些数据来自菜单表和操作权限表。

系统通过角色-权限关联表查询该角色当前已拥有的权限，并自动勾选树中对应的节点。

超级管理员通过勾选或取消勾选树节点，调整该角色拥有的权限集合。

点击“保存”按钮。

系统首先清空角色-权限关联表中该角色的所有现有权限记录。

然后，将界面上新勾选的所有权限点（菜单ID、操作ID）与该角色ID建立关联，批量插入角色-权限关联表。

系统提示“权限分配成功”。

用例结束。

辅事件流:

7a. 保存过程中发生错误（如数据库冲突）：

系统回滚整个保存操作，提示“保存失败，权限未变更”。

权限树恢复为保存前的勾选状态。

用例结束。

后置条件: 角色-权限关联表中该角色的权限关联记录被更新。拥有此角色的所有用户的实际权限将随之改变。

用例6: 为用户分配角色
用例名称: 为用户分配角色

参与者: 超级管理员（主要参与者）

前置条件: 超级管理员已成功登录系统，且系统中已存在用户和角色。

主事件流:

超级管理员在“用户管理”界面，选择一个目标用户。

点击“分配角色”按钮。

系统弹出角色分配对话框，列出系统中所有可用的角色（来自角色表）。

系统通过用户-角色关联表查询该用户当前已拥有的角色，并自动勾选对应的角色。

超级管理员通过勾选或取消勾选，调整该用户所拥有的角色。

点击“确定”按钮。

系统首先清空用户-角色关联表中该用户的所有现有角色记录。

然后，将新勾选的角色ID与该用户ID建立关联，批量插入用户-角色关联表。

系统提示“角色分配成功”。

用例结束。

辅事件流:

7a. 保存过程中发生错误：

系统回滚操作，提示“分配失败，角色未变更”。

角色列表恢复为操作前的勾选状态。

用例结束。

后置条件: 用户-角色关联表中该用户的角色关联记录被更新。该用户下次登录时，将加载新的角色对应的权限集合。

用例7: 查询菜单树
用例名称: 查询菜单树

参与者: 普通用户、超级管理员（主要参与者）

前置条件: 用户已成功登录系统。

主事件流:

用户登录成功后，系统需要加载导航菜单。

前端应用向后端发送“查询菜单树”请求，携带当前用户的ID。

后端接收到请求。

后端从菜单表中查询所有有效的菜单项，并构建完整的菜单树形结构。

后端根据当前用户ID，通过用户-角色关联表和角色-权限关联表，查询出该用户拥有的所有菜单权限标识符的集合。

后端应用全局可见性规则：遍历完整菜单树，过滤掉is_global_visible为false的菜单节点。

后端应用用户权限规则：在已过滤全局不可见菜单的树基础上，再次过滤，仅保留用户拥有权限的菜单节点。

后端将最终过滤后的菜单树数据返回给前端。

前端根据返回的菜单树数据，渲染生成左侧导航栏或主导航菜单。

用例结束。

辅事件流:

无。此用例是查询操作，不涉及用户交互决策分支。

后置条件: 用户界面正确显示了当前用户有权限访问且全局可见的菜单结构。

用例8: 动态权限校验
用例名称: 动态权限校验

参与者: 权限校验系统（次要参与者，系统内部组件），普通用户、超级管理员（触发者）

前置条件: 用户已成功登录系统，且其权限集合已加载。

主事件流:

前端校验（控制显隐）:

用户进入一个功能页面。

前端组件加载时，检查当前用户权限集合中是否包含该页面按钮所需的操作权限标识符（如user:add）。

如果包含，则正常显示按钮；否则，隐藏或禁用该按钮。

后端校验（核心安全校验）:

用户点击一个按钮（如“删除”），前端发起API请求（如DELETE /api/users/123）。

请求到达后端接口。

后端的权限拦截器/过滤器被触发。它解析请求对应的操作权限标识符（如user:delete）。

拦截器从当前用户会话中获取其权限集合。

拦截器判断用户的权限集合是否包含所需的操作权限标识符。

如果包含，则放行请求，执行相应的业务逻辑。

用例结束（校验通过）。

辅事件流:

8a. 后端校验不通过（用户权限集合中不包含所需权限）：

拦截器中断请求处理。

拦截器返回一个标准的错误响应（如HTTP 403 Forbidden）。

触发「无权限提示」用例。

用例结束（校验失败）。

后置条件: 用户的操作请求根据其权限被允许执行或被拒绝。

用例9: 无权限提示
用例名称: 无权限提示

参与者: 普通用户、超级管理员（主要参与者）

前置条件: 「动态权限校验」用例的后端校验流程失败（主事件流8a）。

主事件流:

前端应用接收到后端返回的权限校验失败响应（如HTTP 403）。

前端统一拦截此类错误响应。

前端在界面中央弹出模态对话框或全局提示消息。

对话框内容为清晰的提示信息，例如：“抱歉，您无此操作权限！”。

对话框提供一个“确定”按钮。

用户点击“确定”按钮，关闭对话框。

用例结束。

辅事件流:

6a. 用户不点击确定，而是点击对话框外部或按ESC键：

同样关闭对话框。

用例结束。

后置条件: 用户被告知操作被拒绝的原因，界面状态恢复正常。